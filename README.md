# SWJTU-LibSeatGetter
西南交大图书馆抢座系统

---
### 网址
http://lib.steelblue.cn

### 说明
- 本软件主要用于解决期末考试期间图书馆爆满，抢不到座位的问题
- 原理类似12306抢票，不断扫描所有座位，在空座出现时立即抢座
- 排除了2楼考研自习室
- 未使用任何方式在后台对用户数据进行储存
- 特别感谢[@卖女孩的小火柴](https://www.shinenet.cn)在软件编写过程中提供的帮助
- 本软件仅供学习交流

---
### 编写原因
初学web编程，又刚买了云服务器，想写个项目练手。想到室友之前易语言编写的抢座软件，非常好用但是只能在电脑上运行，所以准备编写一个web服务，跑在云服务器上，这样随时都可以用手机抢座，方便的多。

### 前期分析
刚开始我认为web服务不过是把本地服务搬上服务器，每个用户使用一个单独的线程，后来发现uwsgi的请求会复用线程，也就是不同的用户在同一个脚本下同时工作，这样就要考虑多用户的管理问题，一下子复杂了起来。
第一次接触这样问题的我感到十分懵比，好在室友提供了一个思路：把用户放在一个list里面，然后单独出一个抢座线程，监控用户list，一旦有用户就开始抢座。
带佬就是不一样！顺着这个思路，一下就找到了方向。

### 编写思路
#### 用户管理
用`tmp_users`，`waiting_users`，`running_users`，`success_users`，`fail_users`分别储存登录但未开始抢座的用户，正在等待抢座的用户，正在抢座的用户，成功的用户，失败的用户，一个用户从登录到抢座成功的过程就是在不同的类别间转换的过程。
#### 抢座过程
用户登录后进入`tmp_users`，点击抢座后进入`waiting_users`，抢座线程不断查看`waiting_users`，一旦出现用户即将其塞进`running_users`，并开始遍历座位为其抢座，抢座成功进入`success_users`，反之进入`fail_users`。
#### 状态保持
用户在进行座位预约时需保持登录或重新登录，考虑到操作cookie太过繁琐，所以干脆使用requests库的session功能对用户的登录状态进行记录，故`tmp_users`，`waiting_users`使用字典数据结构，键为用户id，值为session。

### 资源准备
用户的问题解决了，就剩爬虫的部分了，在学校图书馆的网上预约系统`http://zuowei.lib.swjtu.edu.cn/Home/web/index`中，走一遍寻座、预约的流程，同时用Chrome的开发者工具进行抓包，很快找到了需要的url。

### 